<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ö—Ä–∏–ø—Ç–æ-–ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-6">
  <div class="max-w-5xl mx-auto bg-white p-6 rounded-2xl shadow-md">
    <h1 class="text-2xl font-bold mb-4">üìä –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–π –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã</h1>

    <!-- –¢–µ–∫—É—â–∏–π –∫—É—Ä—Å -->
    <div id="eurRateBox" class="mb-4 text-lg font-semibold text-green-600">–ó–∞–≥—Ä—É–∑–∫–∞ –∫—É—Ä—Å–∞ USD‚ÜíEUR...</div>

    <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
    <form id="addForm" class="grid grid-cols-6 gap-2 mb-4">
      <input type="date" id="date" class="col-span-1 border p-2 rounded" required>

      <!-- –í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –≤–∞–ª—é—Ç -->
      <select id="currency" class="col-span-1 border p-2 rounded" required>
        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞–ª—é—Ç—É</option>
        <option value="BTC">BTC</option>
        <option value="ETH">ETH</option>
        <option value="BNB">BNB</option>
        <option value="USDT">USDT</option>
        <option value="LTC">LTC</option>
        <option value="–î—Ä—É–≥–∏–µ">–î—Ä—É–≥–∏–µ</option>
      </select>

      <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è "–î—Ä—É–≥–∏–µ" -->
      <input type="text" id="currencyOther" placeholder="–í–≤–µ–¥–∏—Ç–µ –¥—Ä—É–≥—É—é –≤–∞–ª—é—Ç—É" class="col-span-1 border p-2 rounded" style="display:none;">

      <input type="number" id="amount" placeholder="–°—É–º–º–∞" step="0.0001" class="col-span-1 border p-2 rounded" required>
      <input type="number" id="rate" placeholder="–ö—É—Ä—Å $" step="0.01" class="col-span-1 border p-2 rounded" required>
      <input type="text" id="note" placeholder="–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ" class="col-span-1 border p-2 rounded">
      <button type="submit" class="col-span-1 bg-blue-500 text-white rounded p-2 hover:bg-blue-600">–î–æ–±–∞–≤–∏—Ç—å</button>
    </form>

    <!-- –¢–∞–±–ª–∏—Ü–∞ -->
    <div class="overflow-x-auto">
      <table class="w-full border-collapse border border-gray-300 text-sm text-center">
        <thead class="bg-gray-200">
          <tr>
            <th class="border p-2">–î–∞—Ç–∞</th>
            <th class="border p-2">–í–∞–ª—é—Ç–∞</th>
            <th class="border p-2">–°—É–º–º–∞</th>
            <th class="border p-2">–ö—É—Ä—Å $</th>
            <th class="border p-2">–°—Ç–æ–∏–º–æ—Å—Ç—å $</th>
            <th class="border p-2">–°—Ç–æ–∏–º–æ—Å—Ç—å ‚Ç¨</th>
            <th class="border p-2">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</th>
            <th class="border p-2">–î–µ–π—Å—Ç–≤–∏—è</th>
          </tr>
        </thead>
        <tbody id="tableBody"></tbody>
        <tfoot class="bg-gray-100 font-bold">
          <tr>
            <td colspan="5" class="border p-2 text-right">–ò—Ç–æ–≥–æ:</td>
            <td class="border p-2" id="totalEur">0 ‚Ç¨</td>
            <td colspan="2" class="border p-2"></td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>

  <script>
    let data = JSON.parse(localStorage.getItem("cryptoData")) || [];
    let eurRate = 0;

    const tableBody = document.getElementById("tableBody");
    const addForm = document.getElementById("addForm");
    const totalEur = document.getElementById("totalEur");
    const eurRateBox = document.getElementById("eurRateBox");

    const currencySelect = document.getElementById("currency");
    const currencyOther = document.getElementById("currencyOther");

    // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–æ–ª–µ "–î—Ä—É–≥–∏–µ"
    currencySelect.addEventListener("change", () => {
      if(currencySelect.value === "–î—Ä—É–≥–∏–µ") {
        currencyOther.style.display = "block";
      } else {
        currencyOther.style.display = "none";
      }
    });

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫—É—Ä—Å USD‚ÜíEUR
    async function loadEurRate() {
      try {
        let res = await fetch("https://api.exchangerate.host/latest?base=USD&symbols=EUR");
        let json = await res.json();
        eurRate = json.rates.EUR;
        eurRateBox.textContent = `–¢–µ–∫—É—â–∏–π –∫—É—Ä—Å: 1 USD = ${eurRate.toFixed(4)} EUR`;
        renderTable();
      } catch (e) {
        eurRateBox.textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫—É—Ä—Å–∞!";
      }
    }

    function renderTable() {
      tableBody.innerHTML = "";
      let sumEur = 0;

      data.forEach((item, index) => {
        let usdValue = item.amount * item.rate;
        let eurValue = eurRate ? usdValue * eurRate : 0;
        sumEur += eurValue;

        let row = document.createElement("tr");
        row.innerHTML = `
          <td class="border p-2">${item.date}</td>
          <td class="border p-2">${item.currency}</td>
          <td class="border p-2">${item.amount}</td>
          <td class="border p-2">${item.rate}</td>
          <td class="border p-2">${usdValue.toFixed(2)} $</td>
          <td class="border p-2">${eurValue.toFixed(2)} ‚Ç¨</td>
          <td class="border p-2">${item.note}</td>
          <td class="border p-2">
            <button onclick="editItem(${index})" class="bg-yellow-400 text-white px-2 py-1 rounded mr-1">‚úè</button>
            <button onclick="deleteItem(${index})" class="bg-red-500 text-white px-2 py-1 rounded">üóë</button>
          </td>
        `;
        tableBody.appendChild(row);
      });

      totalEur.textContent = sumEur.toFixed(2) + " ‚Ç¨";
    }

    addForm.addEventListener("submit", e => {
      e.preventDefault();
      let currencyValue = currencySelect.value === "–î—Ä—É–≥–∏–µ" ? currencyOther.value : currencySelect.value;
      let newItem = {
        date: document.getElementById("date").value,
        currency: currencyValue,
        amount: parseFloat(document.getElementById("amount").value),
        rate: parseFloat(document.getElementById("rate").value),
        note: document.getElementById("note").value
      };
      data.push(newItem);
      localStorage.setItem("cryptoData", JSON.stringify(data));
      renderTable();
      addForm.reset();
      currencyOther.style.display = "none"; // —Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
    });

    function deleteItem(index) {
      data.splice(index, 1);
      localStorage.setItem("cryptoData", JSON.stringify(data));
      renderTable();
    }

    function editItem(index) {
      let item = data[index];
      document.getElementById("date").value = item.date;
      if(["BTC","ETH","BNB","USDT","LTC"].includes(item.currency)) {
        currencySelect.value = item.currency;
        currencyOther.style.display = "none";
      } else {
        currencySelect.value = "–î—Ä—É–≥–∏–µ";
        currencyOther.style.display = "block";
        currencyOther.value = item.currency;
      }
      document.getElementById("amount").value = item.amount;
      document.getElementById("rate").value = item.rate;
      document.getElementById("note").value = item.note;
      deleteItem(index);
    }

    loadEurRate();
  </script>
</body>
</html>
